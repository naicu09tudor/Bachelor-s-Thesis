%% Wind Turbine Parameters

% Cp - Performance Coefficient constants 
c1 = 0.22;
c2 = 116;
c3 = 0.4; 
c4 = 0;
c5 = 5; 
c6 = 12.5;

% Conform graficului, beta = 0:
lambda_opt = 6.33;
Cp_opt = 0.4382;                            % Coeficient optim de putere = 43.82%

ro = 1.225;                                 % Air density [hg/m^3]
R = 5;                                      % Blade radius [m]
A = pi*R^2;                                 % Turbine swept are [m^2]
wind_speed = 12;                            % [m/s]
Pm = 1/2 * Cp_opt * ro * A * wind_speed^3;  % Pm = 36.42 kW
omega_r = lambda_opt * wind_speed / R;      % 15.19 [rad/s]

%% PMSG Parameters

Rs = 2.875;        % Stator Resistance [ohm]
Ld = 1.53e-3;      % Inductance on d-axis [mH]
Lq = 1.53e-3;      % Inductance on q-axis [mH]
Ke = 0.175;        % Permanent Magnet flux [Wb]
p = 4;             % Pole Pairs
J = 0.8e-3;        % Moment of Inertia [Nm^2] 
F = 1e-3;          % Frecare vascoasa 
n1 = 15;
n2 = 1000;


%% Buck & Boost Parameters

L_buck = 300e-6;    % Buck Converter Inductance    [microH]
C_buck = 5e-6;      % Buck Converter Capacitance   [microF] 
L_boost = 200e-6;   % Boost Converter Inductance   [microH]
C_boost = 50e-6;    % Boost Converter Capacitance  [microF]
Rl_boost = 10.73;   % Boost Converter Load Resistance [ohm]

% Buck 1D Look-Up Table [Power - Load Resistance]
%P_buck_v = 1.0e3 * [0.01    0.4272    0.8544   1.2816    1.7088    2.1360...
%          2.5632    2.9904    3.4176    3.8448    4.2720];

%R_buck_load_v = [230.4000    5.3933    2.6966    1.7978    1.3483    1.0787...
%         0.8989    0.7705    0.6742    0.5993    0.5393];

P_buck_v = 1.0e+03 * [0.01, 0.0427, 0.0854, 0.1282, 0.1709, 0.2136, 0.2563, 0.2990, 0.3418, 0.3845, 0.4272, ...
                      0.4699, 0.5126, 0.5554, 0.5981, 0.6408, 0.6835, 0.7262, 0.7690, 0.8117, 0.8544, ...
                      0.8971, 0.9398, 0.9826, 1.0253, 1.0680, 1.1107, 1.1534, 1.1962, 1.2389, 1.2816, ...
                      1.3243, 1.3670, 1.4098, 1.4525, 1.4952, 1.5379, 1.5806, 1.6234, 1.6661, 1.7088, ...
                      1.7515, 1.7942, 1.8370, 1.8797, 1.9224, 1.9651, 2.0078, 2.0506, 2.0933, 2.1360, ...
                      2.1787, 2.2214, 2.2642, 2.3069, 2.3496, 2.3923, 2.4350, 2.4778, 2.5205, 2.5632, ...
                      2.6059, 2.6486, 2.6914, 2.7341, 2.7768, 2.8195, 2.8622, 2.9050, 2.9477, 2.9904, ...
                      3.0331, 3.0758, 3.1186, 3.1613, 3.2040, 3.2467, 3.2894, 3.3322, 3.3749, 3.4176, ...
                      3.4603, 3.5030, 3.5458, 3.5885, 3.6312, 3.6739, 3.7166, 3.7594, 3.8021, 3.8448, ...
                      3.8875, 3.9302, 3.9730, 4.0157, 4.0584, 4.1011, 4.1438, 4.1866, 4.2293, 4.2720];

%R_buck_load = 48^2 ./ P_buck_v;
R_buck_load_v = [230.4000, 53.9326, 26.9663, 17.9775, 13.4831, 10.7865, 8.9888, 7.7047, 6.7416, 5.9925, 5.3933, ...
                 4.9030, 4.4944, 4.1487, 3.8523, 3.5955, 3.3708, 3.1725, 2.9963, 2.8386, 2.6966, 2.5682, ...
                 2.4515, 2.3449, 2.2472, 2.1573, 2.0743, 1.9975, 1.9262, 1.8597, 1.7978, 1.7398, 1.6854, ...
                 1.6343, 1.5863, 1.5409, 1.4981, 1.4576, 1.4193, 1.3829, 1.3483, 1.3154, 1.2841, 1.2542, ...
                 1.2257, 1.1985, 1.1724, 1.1475, 1.1236, 1.1007, 1.0787, 1.0575, 1.0372, 1.0176, 0.9988, ...
                 0.9806, 0.9631, 0.9462, 0.9299, 0.9141, 0.8989, 0.8841, 0.8699, 0.8561, 0.8427, 0.8297, ...
                 0.8172, 0.8050, 0.7931, 0.7816, 0.7705, 0.7596, 0.7491, 0.7388, 0.7288, 0.7191, 0.7096, ...
                 0.7004, 0.6914, 0.6827, 0.6742, 0.6658, 0.6577, 0.6498, 0.6421, 0.6345, 0.6271, 0.6199, ...
                 0.6129, 0.6060, 0.5993, 0.5927, 0.5862, 0.5799, 0.5738, 0.5677, 0.5618, 0.5560, 0.5503, ...
                 0.5448, 0.5393];


%% Rectifier Parameters

% Rectifier 1D Look-Up Table [Power - Load Resistance]
%P_rec_v = 1.0e3 * [0.01    0.4180    0.8360    1.2540  1.386   1.6720    2.0900...
%        2.5080    2.9260    3.3440    3.7620    4.1800   4.5474];

%R_rec_load_v = [4840 115.8 57.9  38.6 34.9206 28.9 23.2 19.3 16.5 14.5 12.9 11.6  10.6434];

P_rec_v = 1.0e+03 * [0.01, 0.0432, 0.0864, 0.1296, 0.1727, 0.2159, 0.2591, 0.3023, 0.3455, 0.3887, 0.4319, ...
                    0.4750, 0.5182, 0.5614, 0.6046, 0.6478, 0.6910, 0.7342, 0.7773, 0.8205, 0.8637, ...
                    0.9069, 0.9501, 0.9933, 1.0365, 1.0796, 1.1228, 1.1660, 1.2092, 1.2524, 1.2956, ...
                    1.3388, 1.3820, 1.4251, 1.4683, 1.5115, 1.5547, 1.5979, 1.6411, 1.6843, 1.7274, ...
                    1.7706, 1.8138, 1.8570, 1.9002, 1.9434, 1.9866, 2.0297, 2.0729, 2.1161, 2.1593, ...
                    2.2025, 2.2457, 2.2889, 2.3320, 2.3752, 2.4184, 2.4616, 2.5048, 2.5480, 2.5912, ...
                    2.6343, 2.6775, 2.7207, 2.7639, 2.8071, 2.8503, 2.8935, 2.9366, 2.9798, 3.0230, ...
                    3.0662, 3.1094, 3.1526, 3.1958, 3.2389, 3.2821, 3.3253, 3.3685, 3.4117, 3.4549, ...
                    3.4981, 3.5413, 3.5844, 3.6276, 3.6708, 3.7140, 3.7572, 3.8004, 3.8436, 3.8867, ...
                    3.9299, 3.9731, 4.0163, 4.0595, 4.1027, 4.1459, 4.1890, 4.2322, 4.2754, 4.3186];


%R_rec_load = 220^2 ./ P_rec_v
R_rec_load_v = 1.0e+03 * [4.8400, 1.1204, 0.5602, 0.3735, 0.2803, 0.2242, 0.1868, 0.1601, 0.1401, 0.1245, 0.1121, ...
                          0.1019, 0.0934, 0.0862, 0.0801, 0.0747, 0.0700, 0.0659, 0.0623, 0.0590, 0.0560, 0.0534, ...
                          0.0509, 0.0487, 0.0467, 0.0448, 0.0431, 0.0415, 0.0400, 0.0386, 0.0374, 0.0362, 0.0350, ...
                          0.0340, 0.0330, 0.0320, 0.0311, 0.0303, 0.0295, 0.0287, 0.0280, 0.0273, 0.0267, 0.0261, ...
                          0.0255, 0.0249, 0.0244, 0.0238, 0.0233, 0.0229, 0.0224, 0.0220, 0.0216, 0.0211, 0.0208, ...
                          0.0204, 0.0200, 0.0197, 0.0193, 0.0190, 0.0187, 0.0184, 0.0181, 0.0178, 0.0175, 0.0172, ...
                          0.0170, 0.0167, 0.0165, 0.0162, 0.0160, 0.0158, 0.0156, 0.0154, 0.0151, 0.0149, 0.0147, ...
                          0.0146, 0.0144, 0.0142, 0.0140, 0.0138, 0.0137, 0.0135, 0.0133, 0.0132, 0.0130, 0.0129, ...
                          0.0127, 0.0126, 0.0125, 0.0123, 0.0122, 0.0121, 0.0119, 0.0118, 0.0117, 0.0116, 0.0114, 0.0113, 0.0112];


D_voltage = 1.975/220; % IGBT/Diode Voltage scaling
C_rectifier = 1e-3;    % Rectifier Capacitance 

%% Battery Parameters

State_Of_Charge = 65;
Cap_sys = 1111; % Ah
Cap_cell = 3.2; % Ah

V_nom_sys = 48;   % V
V_nom_cell = 3.6; % V

Nr_cells_series = round(V_nom_sys/V_nom_cell); % 13 celule serie
Nr_cells_parallel = round(Cap_sys/Cap_cell);   % 347 celule paralel

I_bat_impulse = 3.12; % A
T = 1020; % sec
Tau = 180; % sec

Rs_cell = (3.8-3.5)/I_bat_impulse;  % 0.0962 ohm
Rp_cell = (3.5-3.38)/I_bat_impulse; % 0.0385 ohm
Cp_cell = Tau/Rp_cell;              % 4772 Farad

% Parameters First-order Model
Rs_sys = (Nr_cells_series * Rs_cell) / Nr_cells_parallel;  % 0.0036 ohm
Rp_sys = (Nr_cells_series * Rp_cell) / Nr_cells_parallel;  % 0.0014 ohm
Cp_sys = (Nr_cells_parallel * Cp_cell) / Nr_cells_series;  % 124920 Farad

% Params Second-order Model
Rp1 = 0.0099;
Cp1 = 1182;
Rp_sys1 = (Nr_cells_series * Rp1) / Nr_cells_parallel; 
Cp_sys1 = (Nr_cells_parallel * Cp1) / Nr_cells_series; 

Rp2 = 0.0375;
Cp2 = 3137;
Rp_sys2 = (Nr_cells_series * Rp2) / Nr_cells_parallel; 
Cp_sys2 = (Nr_cells_parallel * Cp2) / Nr_cells_series;  

%%
OCV_curve = [40, 44.8, 48, 50.40, 51.20, 51.60, 52, 52.20, 52.40, 52.80, 53.20, 53.60, 52.80, 54, 55.20, 58.40];
SOC = [0 5 9.5 14 20 30 40 50 60 70 80 90 96 99 99.5 100];

% Reprezentarea grafică
figure;
plot(SOC, OCV_curve, 'b-o', 'LineWidth', 1.5);
grid on;
title('Relația dintre Tensiunea de Circuit Deschis (OCV) și Starea de Încărcare (SOC)');
xlabel('SOC (%)');
ylabel('OCV (V)');
legend('Curba OCV-SOC');
